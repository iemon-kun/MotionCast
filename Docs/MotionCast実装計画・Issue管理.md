## 前提・決定事項
- 参考リンク: https://docs.cluster.mu/creatorkit/ , https://docs.cluster.mu/script/index.html
- VRM優先対応: 0.x（将来1.0拡張は別Issue）
- 対応OS優先: macOS優先（Windowsは後続フェーズで検証）
- 導入ポリシー: 設計と矛盾しない範囲で導入。矛盾する場合は導入しない（最小依存）

## フェーズ構成
- フェーズ1（Walking Skeleton）: 最小構成でアプリが起動し、UIスタブとUDP/OSC送信の土台を用意する。/ 含むIssue番号: #1, #2, #3, #4
- フェーズ2（MVP E2E：表情中心）: カメラ→顔推定→VRM（表情）→最小OSC送信を垂直スライスで成立させる。/ 含むIssue番号: #5, #6, #7, #8, #9, #10, #11, #12
- フェーズ3（上半身拡張）: 上半身（首・肩・腕・胸）の推定・マッピング・送信を拡張し、UIから調整可能にする。/ 含むIssue番号: #13, #14, #15, #16
- フェーズ4（自動化）: CI/CDでビルド・配布の自動化を整備する。/ 含むIssue番号: #17, #18, #19
- フェーズ5（堅牢化）: エラー処理、設定永続化、メトリクス、テスト・手順書で安定運用に近づける。/ 含むIssue番号: #20, #21, #22, #23

## 依存関係マップ
- #1 → #2 → #5 → #6 → #7
- #1 → #3 → #4 → #10 → #11
- (#8, #7) → #9
- #5 → #13 → #14
- (#13, #10) → #15
- #7 → #12 → #16
- #1 → #17 → #18 → #19
- (#10, #11) → #22
- (#2, #3) → #21
- (#10, #15) → #20
- #18 → #23

## Issueアウトライン表
##### Issue #1：Tauri + Vite + React + TS の初期セットアップ
**概要**: 開発環境と最小アプリを起動可能にする（`tauri dev`動作、macOS優先）。
**依存**: -
**ラベル**: infra, build
**受け入れ基準（AC）**:
- [ ] macOSで`tauri dev`が起動する
- [ ] TypeScript/ESLint/Prettierの基本設定が入る
- [ ] ルートREADMEに起動手順を記載
- [ ] 不要なサンプルコードを削除し空の画面を表示

##### Issue #2：UIスタブ移植（Docs/frontend_sample.htmlをReactへ）
**概要**: サンプルUIをTSXへ移植し、同等のレイアウトと挙動（ローカル状態/永続）を再現。
**依存**: #1
**ラベル**: frontend
**受け入れ基準（AC）**:
- [ ] サンプルのセマンティクス/クラス構造を踏襲（変更しない）
- [ ] サイドバー開閉/送信ボタン/メトリクス開閉が動作
- [ ] `localStorage`で主要設定が永続（デバイス/解像度/FPS等）
- [ ] アクセシビリティ属性（aria-*）が付与済み
- [ ] UI文言が日本語で統一

##### Issue #3：Tauri IPC雛形（フロント↔Rustコマンド）
**概要**: フロントからRustコマンド呼び出し（ping）を往復できる最小実装。
**依存**: #1
**ラベル**: backend
**受け入れ基準（AC）**:
- [ ] `invoke('ping')`でRust側から固定応答が返る
- [ ] エラー時にUIに日本語メッセージ表示
- [ ] 型安全なパラメータ受け渡し（TS定義あり）

##### Issue #4：UDP/OSC送信スタブ（roscでテストパケット）
**概要**: Rust側でUDP/OSC送信を行い、任意のIP/Portへテストメッセージを送れる。
**依存**: #3
**ラベル**: backend
**受け入れ基準（AC）**:
- [ ] roscで`/app/ping`を1回送出できる
- [ ] IP/PortはUIから指定して渡せる
- [ ] 送信成否をUIへ返し表示できる
- [ ] macOSローカルで受信確認（受信ツールで可）

##### Issue #5：カメラ映像取得とプレビュー
**概要**: MediaStreamでWebカメラ映像を取得し、UIのプレビューに表示。
**依存**: #2
**ラベル**: frontend
**受け入れ基準（AC）**:
- [ ] 選択した解像度/FPSの反映（可能な範囲で）
- [ ] プレビューの表示/非表示切替がスムーズ
- [ ] 権限未許可時に対処メッセージを表示
- [ ] デバイス切替後に再取得できる

##### Issue #6：MediaPipe Face Landmarker統合
**概要**: 顔ランドマーク推定を実行し、主要点群を取得。
**依存**: #5
**ラベル**: frontend
**受け入れ基準（AC）**:
- [ ] 推定が有効/無効でCPU負荷に差が見える
- [ ] ランドマーク取得失敗時のハンドリング
- [ ] FPS低下時に処理間引き（簡易）

##### Issue #7：まばたき/口開き推定ロジック
**概要**: 顔ランドマークからBlink/MouthOpen等のスカラー値を安定算出。
**依存**: #6
**ラベル**: frontend
**受け入れ基準（AC）**:
- [ ] 両目Blink値（0.0〜1.0相当）が算出できる
- [ ] 口開き度（0.0〜1.0相当）が算出できる
- [ ] 外れ値除去の簡易ガードあり
- [ ] 単体関数のスモークテスト（最小）

##### Issue #8：VRM読み込み・表示（Three.js + three-vrm）
**概要**: VRM 0.xファイルを読み込み、ビューワに表示できる。
**依存**: #2
**ラベル**: frontend
**受け入れ基準（AC）**:
- [ ] UIからVRMファイル選択→表示される
- [ ] リセットで未読み込み状態へ戻せる
- [ ] VRM 0.xでの基本互換（1.0は対象外）
- [ ] 負荷が高すぎる場合の軽減策（品質低下等）を準備

##### Issue #9：VRM BlendShapeマッピング（Blink/Mouth）
**概要**: 推定結果をVRMの表情（Blink/Mouth）へ反映。
**依存**: #7, #8
**ラベル**: frontend
**受け入れ基準（AC）**:
- [ ] Blink/Mouthがビューワで滑らかに反映
- [ ] 値域クリップと簡易スムーズ化で暴れを抑制
- [ ] 表情反映のON/OFF切替が可能
- [ ] VRM 0.xの表情名に合わせる

##### Issue #10：最小OSCスキーマ定義と送信（表情+頭）
**概要**: cluster互換の最小OSC項目（Blink/Mouth/Head）を定義し、送信実装。
**依存**: #4, #7
**ラベル**: backend
**受け入れ基準（AC）**:
- [ ] 最小アドレスと値形式を仮定しドキュメント化（cluster Docs参照）
- [ ] 送信ループでBlink/Mouth/Headが更新送出
- [ ] 無効時は送信停止（ゼロ送出しない）
- [ ] 送信レートを設定値に追従

##### Issue #11：送信制御（開始/停止・レート制御）
**概要**: UIボタンと連動し、送信ループ開始/停止・レート設定を統合制御。
**依存**: #10
**ラベル**: frontend, backend
**受け入れ基準（AC）**:
- [ ] 「送信開始/停止」で確実にON/OFF
- [ ] FPS指定に応じて送信間隔が変化
- [ ] 停止中は送信ゼロパケットが出ない
- [ ] 状態をUIのステータスで可視化

##### Issue #12：簡易スムージング実装（EMAまたはOneEuroの片方）
**概要**: 値のスムーズ化を1方式に絞って実装・適用。
**依存**: #7
**ラベル**: frontend
**受け入れ基準（AC）**:
- [ ] スムージングON/OFFが切替可能
- [ ] パラメータがUIスライダーに連動
- [ ] 過度な遅延が生じない（目安: 1フレーム程度）
- [ ] 設定が永続化される

##### Issue #13：MediaPipe Pose Landmarker統合（上半身）
**概要**: 上半身（首・肩・腕・胸）に必要なランドマークを取得。
**依存**: #5
**ラベル**: frontend
**受け入れ基準（AC）**:
- [ ] 上半身のみの推定に限定し負荷を抑制
- [ ] 取得失敗/遮蔽時のハンドリング
- [ ] 簡易可視化（デバッグ表示）が可能（任意）

##### Issue #14：VRMボーンマッピング（首・肩・腕・胸）
**概要**: 上半身ランドマークからVRMボーン回転を算出・適用。
**依存**: #13, #8
**ラベル**: frontend
**受け入れ基準（AC）**:
- [ ] 首・肩・腕・胸の基本姿勢が反映
- [ ] ひどいジッタを抑えるクリップ/補正
- [ ] 表情マッピングと干渉しない

##### Issue #15：OSC拡張（上半身姿勢）
**概要**: 上半身骨格の最小セットをOSC拡張し送信。
**依存**: #13, #10
**ラベル**: backend
**受け入れ基準（AC）**:
- [ ] 追加アドレス/値定義をドキュメント更新
- [ ] 姿勢値が送信ループで安定送出
- [ ] 送信項目のON/OFF切替（上半身のみ停止も可）

##### Issue #16：スムージング調整UI（上半身含む全体適用）
**概要**: スムージングパラメータをUIから調整し、表情/姿勢に一貫適用。
**依存**: #12, #14
**ラベル**: frontend
**受け入れ基準（AC）**:
- [ ] 表情/姿勢が同一ポリシーでスムーズ化
- [ ] プリセット保存/復元（localStorage）
- [ ] 初期値にリセットできる

##### Issue #17：CI（Lint/型チェック/フロントビルド）
**概要**: GitHub ActionsでESLint/TSチェックとフロントビルドを実行。
**依存**: #1
**ラベル**: ci
**受け入れ基準（AC）**:
- [ ] PR時にLint/型チェックが自動実行
- [ ] 失敗時に明確なログが出る
- [ ] mainブランチで常にビルド可能

##### Issue #18：Tauriバンドル自動化（macOS/Windows）
**概要**: ActionsでTauriのバンドルを行い、成果物をArtifactsに保存（macOS優先）。
**依存**: #17, #3
**ラベル**: ci, build
**受け入れ基準（AC）**:
- [ ] macOS向けバンドルが成功（Windowsは任意で後続）
- [ ] アーティファクトがダウンロード可能
- [ ] シークレット不要で動く（署名は後回し）
- [ ] キャッシュ最適化で所要時間を短縮

##### Issue #19：GitHub Releases自動ドラフト
**概要**: タグ作成でReleaseドラフトを自動生成し、成果物添付。
**依存**: #18
**ラベル**: ci, release
**受け入れ基準（AC）**:
- [ ] タグ作成でドラフトができる
- [ ] 主要変更点テンプレートが入る
- [ ] 成果物がドラフトに添付される

##### Issue #20：エラー処理/ユーザ向けメッセージ強化
**概要**: 権限/デバイス未検出/送信失敗等のエラーを日本語で分かりやすく通知。
**依存**: #10, #15
**ラベル**: frontend, backend
**受け入れ基準（AC）**:
- [ ] 代表エラーごとに具体的原因/対処を表示
- [ ] デバッグログON/OFFの切替がある
- [ ] 異常時もUIが固まらない（復帰可能）

##### Issue #21：設定のJSON永続化（tauri-plugin-store）
**概要**: 重要設定を`config.json`としてディスク保存/読み込み。
**依存**: #3
**ラベル**: backend, infra
**受け入れ基準（AC）**:
- [ ] 起動時に`config.json`を読み込む
- [ ] 保存操作でファイルに書き出し
- [ ] 破損時は安全なデフォルトで復旧

##### Issue #22：メトリクス（FPS/遅延）表示と軽量計測
**概要**: 推定/送信の軽量メトリクスをUIに表示し、負荷の把握を可能に。
**依存**: #11
**ラベル**: frontend
**受け入れ基準（AC）**:
- [ ] 推定FPS/平均遅延/送信レートが表示
- [ ] メトリクス表示のON/OFFで負荷差が出る
- [ ] 計測がクラッシュを誘発しない

##### Issue #23：E2Eスモークテスト/手順書
**概要**: 最低限の手動テスト手順と自動スモーク（起動/主要フロー）を整備。
**依存**: #18
**ラベル**: test, docs
**受け入れ基準（AC）**:
- [ ] 手順書にMVPの確認項目が列挙
- [ ] 起動→カメラ→送信の通し確認が可能
- [ ] CIで最低限のスモークが実行される

## 要確認事項（任意）
- cluster最小OSCスキーマの確定（アドレス命名・正規化範囲・型）。参考: Creator Kit/Script Docs
- MediaPipe Tasksのバージョン固定とモデル資材の配布方法（同梱/初回DL）
- カメラデバイス選択の優先キー（label/ID）と非対応環境でのフォールバック
- Windows検証の実施タイミング（どのフェーズで着手するか）
