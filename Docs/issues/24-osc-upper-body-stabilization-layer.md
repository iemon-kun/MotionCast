## 目的 / 対象 / 背景
- 目的: 画面外や遮蔽時の腕姿勢を自然に保つため、送信側に「安定化レイヤー（可視性ゲート＋ホールド→中立フェード）」を導入する。
- 対象: 送信パイプライン（上半身）。主に `app/src/features/estimation/usePoseLandmarker.ts`（可視性/座標の取得）、`app/src/features/osc/OscBridge.tsx`（送信連携）、必要に応じて `src-tauri/src/lib.rs`（直前の抑制）
- 背景: 片眼カメラや遮蔽では手首/肘が時々欠損する。現状は「未送信=最後の姿勢で固着」。より自然な復帰/減衰が必要。

## 決定事項（Decision）
- 可視性ゲート: 可視性が低い関節は「更新を止める（ホールド）」。短時間（例: 300–500ms）は最後の姿勢を保持。
- フェーズ遷移: ホールドが一定時間を超えたら「中立姿勢（単位Quat）」へ 0.5–1.0s の slerp フェード。
- 復帰時: 再検出後は 0.2–0.4s で徐々に新推定へ合流（スナップを禁止）。
- 動的スムージング: 可視性が下がった側は一時的にスムージング係数を重くする（EMA）。
- 角速度クランプ: 肩/肘/手首で上限（上腕/前腕 180–240°/s、手首 ~360°/s）を設け暴走抑止。
- チェーン段階フォールバック: 欠損は「手首→前腕→上腕…」の順で中立化（下流から緩める）。
- 送信ポリシー: 欠損が短い間は「未送信=ホールド」でOK。長引く場合は中立Quatを明示送信（VMC `/VMC/Ext/Bone/Pos` の回転に `Quaternion.identity`）。
- UI/計測: 閾値/時間/クランプはUIで調整可（#16）。フェーズや抑制回数をメトリクス表示（#22）。

## スコープ / 作業項目（WHAT/HOW）
- 可視性と最終観測時刻の管理（関節ごとに `lastSeenTs`, `phase: normal/hold/fade`）。
- フェーズ別の出力ロジック（保持/フェードのslerp係数算出）。
- 角速度の上限適用（前フレームQuatとの差分から角速度推定しクランプ）。
- チェーン単位の段階フォールバック（手首→前腕→上腕→胸）。
- 送信直前の抑制（`OscBridge.tsx` 側での姿勢決定。必要あれば `src-tauri/src/lib.rs` で最終ゲート）。
- UIは#16で拡張（本Issueでは内部の初期値・ハードコードでも可）。

## 受け入れ基準（Acceptance Criteria）
- [ ] 片腕/両腕が画面外でもスナップせず静かに停止する。
- [ ] 欠損が一定時間続くと中立へ0.5–1.0sでフェードする。
- [ ] 復帰直後は0.2–0.4sでスムーズに追従（スナップなし）。
- [ ] 閾値/時間/クランプをUIで後から調整可能（暫定でも可）。
- [ ] メトリクスにフェーズ数/抑制回数が載る（#22連携）。

## 初期パラメータ（提案値）
- 可視性閾値: 欠損 < 0.3 / 重スムージング帯 0.3–0.6
- ホールド時間: 300–500ms
- 中立フェード: 0.5–1.0s
- 復帰ブレンド: 0.2–0.4s
- 角速度上限: 上腕/前腕 180–240°/s、手首 360°/s

## 依存 / 関連
- 依存: #12（スムージング実装）, #16（スムージングUI拡張）, #15（OSC上半身拡張）, #22（メトリクス）
- 参照: `app/src/features/estimation/usePoseLandmarker.ts`, `app/src/features/osc/OscBridge.tsx`, `src-tauri/src/lib.rs`

## テスト観点
- 単腕/両腕画面外、クロスボディ遮蔽、出入りの連続、高速出入りでの不自然挙動の有無。
- 中立復帰と復帰後のブレンドが滑らかか（目視）。

## 未決事項（Open）
- 可視性の定義（2D/3Dどちらを優先するか、実装都合で選定）。
- 中立の定義（上腕/前腕/手首の各初期姿勢の扱い）。

