# AGENTS.md — AIエージェント運用ルール

本ドキュメントは、本プロジェクトに関与する AI エージェント（Codex CLI / Gemini CLI / Jules / ChatGPT）が共通の方針で安全・効率的に開発を進めるためのルールを定義します。

## 1. 目的 / 適用範囲
- 対象エージェント: Codex CLI / Gemini CLI / Jules / ChatGPT
- 対象作業: コード作成・修正、ドキュメント作成、UI 実装補助、レビュー補助、テスト補助
- 基本原則: 「最小差分」「安全第一」「再現性確保」「人間が読みやすいアウトプット」

## 2. 言語と出力スタイル
- 言語: 回答・コメント・ドキュメントは日本語を基本とする。
- トーン: 簡潔・具体・行動可能。冗長な前置きや不要な絵文字・装飾は禁止。
- 表記: 用語・識別子はコード内は英語、UI 文言・ドキュメントは日本語を基本とする。
- 参照: 既存の設計・仕様は `Docs/` 配下を一次情報源とする（例: `Docs/05_サイトマップ.md`）。

## 3. UI 方針（必読）
- 画面構造は `Docs/frontend_sample.html` を参照・踏襲する。
  - セマンティクスとレイアウト構造（セクション分割、コンポーネントの粒度）を優先して合わせる。
  - 既存の class 名・属性・データキーを変更しない（互換性維持）。
  - アクセシビリティ: コントラスト、フォーカス可視化、キーボード操作、ARIA を考慮。
  - レスポンシブ: サイドバーの表示/非表示や主要領域の拡張はサンプルと同じ挙動を維持。
  - UI 文言は日本語で簡潔・一貫した表現を用いる。

## 4. コミットメッセージ規約（Conventional Commits 準拠）

形式:
```
<type>(<scope>): <subject>

<body>

<footer>
```

- type: `feat` | `fix` | `docs` | `style` | `refactor` | `perf` | `test` | `build` | `ci` | `chore` | `revert`
- scope: 省略可。対象モジュールや領域（例: `ui`, `docs`, `backend`）。
- subject: 50 文字以内・文末句点なし・日本語で命令形（例: 「〜を追加」「〜を修正」）。
- body: 72 桁目程度で改行。WHY/WHAT/HOW を簡潔に。実装理由・代替案・影響範囲を含める。
- footer: `BREAKING CHANGE: ...`、`Closes #123`、`Refs #456` など。

例:
```
feat(ui): 設定サイドバーにFPS選択を追加

UIデモに合わせてFPS選択UIを実装。既定値は30fps。
選択値はlocalStorageに保存し、再読込後も維持。

Refs: Docs/frontend_sample.html
```

禁止事項:
- あいまいな `update` や `misc` の使用
- 目的不明の「WIP」コミット（ドラフトはPR側で扱う）
- 1コミットに複数の無関連変更を混在

## 5. コード/ドキュメント生成スタイル

共通:
- 既存 Lint/Formatter 設定を最優先。未設定の場合は下記のデフォルトを適用。
- 小さな関数・単一責務・副作用の局所化。グローバル状態の乱用を避ける。
- 早期 return / ガード節でネストを浅く保つ。
- コメントは「意図（なぜ）」を記述。コードから自明な「何を」は書かない。
- 例外・エラーはメッセージに原因と対処を含め、人に読める日本語で。

言語別推奨（未設定時の基準）:
- JavaScript/TypeScript: ESLint（recommended）+ Prettier。公開APIには JSDoc。`any` は最終手段。
- Python: ruff + black（可能なら）。型ヒント必須。Docstring は Google 形式推奨。
- Shell: `set -Eeuo pipefail`、shellcheck を意識。
- Markdown: markdownlint を意識。文体は常体で統一。見出しレベルは H2 から開始。
- HTML/CSS: セマンティックHTML。アクセシビリティ属性を適切に付与。サンプルに倣いユーティリティクラス優先。

ドキュメント:
- すべて日本語。`Docs/` 配下に配置し、ファイル名は用途が分かる表現を用いる。
- 先頭に目的・対象・決定事項（Decision）・未決事項（Open）を簡潔に記載。
- 図やUI差分は可能ならスクリーンショットや擬似コードで補足。

## 6. セキュリティ / プライバシー / 品質
- 秘密情報（APIキー・個人情報）をログ・コード・Git 履歴に残さない。`.env` 等はコミット禁止。
- 入力値は必ず検証・エスケープ。XSS/CSRF/Injection/SSRF を想定した防御を行う。
- ブラウザ操作時は `textContent` や適切なサニタイズを使用（`innerHTML` 直書き禁止）。
- 依存追加は最小限。理由と代替検討をコミット本文に残す。
- パフォーマンス: N+1・不要再計算・不要再レンダリングの回避。計測（必要時に軽量な計測ログ）。
- ログ: デバッグ出力は環境変数でON/OFF。個人情報・秘匿情報は出力しない。

## 7. 作業フロー（エージェント向け運用）
- 変更前: 目的/影響範囲/手順を 1–2 文で簡潔に宣言。
- 変更: 差分は最小・局所的に。周辺の無関係な修正は行わない。
- テスト: 変更箇所に近い最小テストから。自動テストがあれば実行（可能範囲で）。
- ドキュメント: 仕様変更やUI変更は `Docs/` を更新し、コミットと一緒に要点を残す。
- レビュー視点: 安全性（破壊的変更の有無）、性能影響、可読性、保守性、UI一貫性、回帰の可能性。

Codex CLI などターミナル主体のエージェント追加ルール:
- 複数コマンドを走らせる前に、直近の意図を短く共有（1–2文）。
- 複数工程の作業は TODO/Plan を明示し、進捗があれば更新。
- 破壊的操作（`rm`, `reset`, 大量変更）は事前了承を取る。

## 8. ファイル/ディレクトリ規約
- 既存構造を尊重し、不要なリネームや階層変更を行わない。
- UI 関連は `Docs/frontend_sample.html` の命名・構造を優先し、差分最小で更新。
- ドキュメントは `Docs/` 配下。サイト構成は `Docs/05_サイトマップ.md` を参照・更新。

## 9. 既存資料の参照
- UIサンプル: `Docs/frontend_sample.html`
- サイトマップ: `Docs/05_サイトマップ.md`
- プロジェクト概要: `README.md`
- エージェント別メモ: `GEMINI.md` など（必要に応じて拡張）

## 10. 変更の扱い
- 本ドキュメントの変更は `docs` または `chore(docs)` としてコミット。
- 変更理由と利用者影響を本文に記載。必要なら関連ドキュメントを同時更新。

---
このガイドはプロジェクト進行に合わせて更新されます。迷った場合は「安全・最小・一貫性」を優先してください。
